include ../config.mk
INCLUDES  := -I../../common/inc

CUDA_DIR = /usr/local/cuda
CUDA_LIB_DIR := $(CUDA_DIR)/lib
CUDA_LIB_DIR64 := $(CUDA_DIR)/lib64

HEADERS     := src
INCLUDE 	:= -I${HEADERS} -I/usr/local/cuda/include
LIB			:= -L/usr/local/cuda/lib64
MODULE		:= newton-raph.out 
LIB_CUDA	:= -lcuda -lcudart
#DEBUG       := -g -G -O0
################################################################################

# Target rules
all: DIR build

DIR:
	@echo ${CPP_FILES}
	@echo ${OBJ_FILES}
	if [ ! -d "./bin" ];then 	\
		mkdir bin;				\
	fi
	if [ ! -d "./obj" ];then 	\
		mkdir obj;				\
	fi


build: $(MODULE)

./obj/newton-raph.o:./src/main.cu
	nvcc $(CFLAGS) $(INCLUDE) -O3 -I$(NVIDIA_HELPER) $(INCLUDES) $(ALL_CCFLAGS) -gencode arch=compute_20,code=compute_20 $(LIB_CUDA) -c $< -o $@

$(MODULE): ./obj/newton-raph.o
	nvcc -O3 $(INCLUDE) -D$(SIM_TYPE) $(LIB) -o ./bin/$@ $+

clean:
	rm -f ./bin/$(MODULE)
	rm -f ./obj/newton-raph.o

clobber: clean
